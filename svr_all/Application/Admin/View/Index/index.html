<script src="https://gw.alipayobjects.com/os/antv/pkg/_antv.g2-3.2.4/dist/g2.min.js"></script>
<script src="https://gw.alipayobjects.com/os/antv/pkg/_antv.data-set-0.8.9/dist/data-set.min.js"></script>
<script type="text/javascript" src="https://webapi.amap.com/maps?v=1.3&key=ce1d7952bfe7215b1cecb51b69ae04f2"></script> 
<script src="https://webapi.amap.com/ui/1.0/main.js"></script>
<style type="text/css" media="screen">
	.layui-text a:not(.layui-btn):hover{
		text-decoration: none;
	}
	.layui-status-imgs{
		width: 58px!important;
		height: 58px!important;
		background-color: #ffffff!important;
		overflow: hidden;
	}
	.layui-status-imgs img{
		width: 100%!important;
		height: 100%!important;
	}		
</style>
<div class="layui-fluid">
	<div class="layui-row">
		<div class="layui-card layui-col-sm12">
			<div class="layui-card-header">
				<div class="layui-btn-group">
					<a class="layui-btn
					<if condition="$Think.get.days eq ''">
						layui-btn-info 
						<else />
						layui-btn-primary
					</if>
					layui-btn-sm" href="{:U("Index/index")}">
					累计
				</a>
				<a class="layui-btn
				<if condition="$Think.get.days eq '1'">
					layui-btn-info 
					<else />
					layui-btn-primary
				</if>
				layui-btn-sm" href="javascript:jumpToSelectedDays(1);">
				今日
			</a>
			<a class="layui-btn 
			<if condition="$Think.get.days eq '7'">
				layui-btn-info 
				<else />
				layui-btn-primary
			</if>
			layui-btn-sm" href="javascript:jumpToSelectedDays(7);">
			7天
		</a>
		<a class="layui-btn  
		<if condition="$Think.get.days eq '15'">
			layui-btn-info 
			<else />
			layui-btn-primary
		</if>
		layui-btn-sm" href="javascript:jumpToSelectedDays(15);">
		15天
	</a>
	<a class="layui-btn  
	<if condition="$Think.get.days eq '30'">
		layui-btn-info 
		<else />
		layui-btn-primary
	</if>
	layui-btn-sm" href="javascript:jumpToSelectedDays(30);">
	1月
</a>
<a class="layui-btn  
<if condition="$Think.get.days eq '90'">
	layui-btn-info 
	<else />
	layui-btn-primary
</if>
 layui-btn-sm" href="javascript:jumpToSelectedDays(90);">
3月
</a>
<a class="layui-btn  
<if condition="$Think.get.days eq '183'">
	layui-btn-info 
	<else />
	layui-btn-primary
</if>
 layui-btn-sm" href="javascript:jumpToSelectedDays(183);">
半年
</a>
<a class="layui-btn  
<if condition="$Think.get.days eq '366'">
	layui-btn-info 
	<else />
	layui-btn-primary
</if>
 layui-btn-sm" href="javascript:jumpToSelectedDays(366);">
1年
</a>
</div>
</div>
</div>
</div>
<div class="layui-row layui-col-space15">
	<div class="layui-col-sm12">
		<div class="layui-card">
			<div class="layui-card-body layui-text">
				<ul class="layui-row layui-col-space10 layui-this">
					<li class="layui-col-xs2">
						<a href="javascript:;" class="layadmin-backlog-body">
							<h3>
								<switch name="Think.get.days">
									<case value="1">今日</case>
									<case value="7">7天</case>
									<case value="15">15天</case>
									<case value="30">1月</case>
									<case value="90">3月</case>
									<case value="183">半年</case>
									<case value="366">1年</case>
									<default />累计
								</switch>用户个数（个）
							</h3>
							<p>
								<cite>{$total_user_amount}</cite>
							</p>
						</a>
					</li>
					<li class="layui-col-xs2">
						<a href="javascript:;" class="layadmin-backlog-body">
							<h3>
								<switch name="Think.get.days">
									<case value="1">今日</case>
									<case value="7">7天</case>
									<case value="15">15天</case>
									<case value="30">1月</case>
									<case value="90">3月</case>
									<case value="183">半年</case>
									<case value="366">1年</case>
									<default />累计
								</switch>充值金额（元）
							</h3>
							<p>
								<cite>{$total_charge_amount}</cite>
							</p>
						</a>
					</li>
					<li class="layui-col-xs2">
						<a href="javascript:;" class="layadmin-backlog-body">
							<h3>
								<switch name="Think.get.days">
									<case value="1">今日</case>
									<case value="7">7天</case>
									<case value="15">15天</case>
									<case value="30">1月</case>
									<case value="90">3月</case>
									<case value="183">半年</case>
									<case value="366">1年</case>
									<default />累计
								</switch>系统糖豆数量（个）
							</h3>
							<p>
								<cite>{$total_coin_amount}</cite>
							</p>
						</a>
					</li>
					<li class="layui-col-xs2">
						<a href="javascript:;" class="layadmin-backlog-body">
							<h3>
								<switch name="Think.get.days">
									<case value="1">今日</case>
									<case value="7">7天</case>
									<case value="15">15天</case>
									<case value="30">1月</case>
									<case value="90">3月</case>
									<case value="183">半年</case>
									<case value="366">1年</case>
									<default />累计
								</switch>抓娃娃次数（次）
							</h3>
							<p>
								<cite>{$total_lottery_amount}</cite>
							</p>
						</a>
					</li>
					<li class="layui-col-xs2">
						<a href="javascript:;" class="layadmin-backlog-body">
							<h3>
								<switch name="Think.get.days">
									<case value="1">今日</case>
									<case value="7">7天</case>
									<case value="15">15天</case>
									<case value="30">1月</case>
									<case value="90">3月</case>
									<case value="183">半年</case>
									<case value="366">1年</case>
									<default />累计
								</switch>送出糖豆数量（个）
							</h3>
							<p>
								<cite>{$total_send_coin_amount}</cite>
							</p>
						</a>
					</li>
					<li class="layui-col-xs2">
						<a href="javascript:;" class="layadmin-backlog-body">
							<h3>
								<switch name="Think.get.days">
									<case value="1">今日</case>
									<case value="7">7天</case>
									<case value="15">15天</case>
									<case value="30">1月</case>
									<case value="90">3月</case>
									<case value="183">半年</case>
									<case value="366">1年</case>
									<default />累计
								</switch>中奖数量（次）
							</h3>
							<p>
								<cite>{$total_lottery_hit_amount}</cite>
							</p>
						</a>
					</li>
					<li class="layui-col-xs2">
						<a href="javascript:;" class="layadmin-backlog-body">
							<h3>
								<switch name="Think.get.days">
									<case value="1">今日</case>
									<case value="7">7天</case>
									<case value="15">15天</case>
									<case value="30">1月</case>
									<case value="90">3月</case>
									<case value="183">半年</case>
									<case value="366">1年</case>
									<default />累计
								</switch>会员数量（个）
							</h3>
							<p>
								<cite>{$total_vip_amount}</cite>
							</p>
						</a>
					</li>

					<li class="layui-col-xs2">
						<a href="javascript:;" class="layadmin-backlog-body">
							<h3>
								<switch name="Think.get.days">
									<case value="1">今日</case>
									<case value="7">7天</case>
									<case value="15">15天</case>
									<case value="30">1月</case>
									<case value="90">3月</case>
									<case value="183">半年</case>
									<case value="366">1年</case>
									<default />累计
								</switch>店铺数量（个）
							</h3>
							<p>
								<cite>{$total_shop_amount}</cite>
							</p>
						</a>
					</li>
					<li class="layui-col-xs2">
						<a href="javascript:;" class="layadmin-backlog-body">
							<h3>
								<switch name="Think.get.days">
									<case value="1">今日</case>
									<case value="7">7天</case>
									<case value="15">15天</case>
									<case value="30">1月</case>
									<case value="90">3月</case>
									<case value="183">半年</case>
									<case value="366">1年</case>
									<default />累计
								</switch>到店次数（次）
							</h3>
							<p>
								<cite>{$total_shop_arrive_amount}</cite>
							</p>
						</a>
					</li>
					<li class="layui-col-xs2">
						<a href="javascript:;" class="layadmin-backlog-body">
							<h3>
								<switch name="Think.get.days">
									<case value="1">今日</case>
									<case value="7">7天</case>
									<case value="15">15天</case>
									<case value="30">1月</case>
									<case value="90">3月</case>
									<case value="183">半年</case>
									<case value="366">1年</case>
									<default />累计
								</switch>到店奖励糖豆（个）
							</h3>
							<p>
								<cite>{$total_shop_arrive_candy_amount}</cite>
							</p>
						</a>
					</li>
					<li class="layui-col-xs2">
						<a href="javascript:;" class="layadmin-backlog-body">
							<h3>
								<switch name="Think.get.days">
									<case value="1">今日</case>
									<case value="7">7天</case>
									<case value="15">15天</case>
									<case value="30">1月</case>
									<case value="90">3月</case>
									<case value="183">半年</case>
									<case value="366">1年</case>
									<default />累计
								</switch>取消关注用户（个）
							</h3>
							<p>
								<cite>{$total_unsubscribe_user_amount}</cite>
							</p>
						</a>
					</li>
					<li class="layui-col-xs2">
						<a href="javascript:;" class="layadmin-backlog-body">
							<h3>
								<switch name="Think.get.days">
									<case value="1">今日</case>
									<case value="7">7天</case>
									<case value="15">15天</case>
									<case value="30">1月</case>
									<case value="90">3月</case>
									<case value="183">半年</case>
									<case value="366">1年</case>
									<default />累计
								</switch>关注用户（个）
							</h3>
							<p>
								<cite>{$total_subscribe_user_amount}</cite>
							</p>
						</a>
					</li>
				</ul>
			</div>
		</div>
	</div>
</div>
<div class="layui-row layui-col-space15">
	<div class="layui-col-sm4">
		<div class="layui-card">
			<div class="layui-tab layui-tab-brief">
				<ul class="layui-tab-title">
					<li class="layui-this">Top10 最受欢迎专场</li>
				</ul>
				<div class="layui-tab-content">
					<div class="layui-tab-item layui-show">
						<dl class="layuiadmin-card-status">
							<volist name="lottery_configs" id="vo">
								<dd>
									<div class="layui-status-img layui-status-imgs"><a href="javascript:;"><img src="{$vo['cover_image']}"></a></div>
									<div>
										<p>{$vo.id}-{$vo['name']}</p>
										<p>消耗{$vo['coin_num']}个糖豆</p>
										<span>被抓{$vo['zhua_times']}次</span>
									</div>
								</dd>
							</volist>
						</dl>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="layui-col-sm4">
		<div class="layui-card">
			<div class="layui-tab layui-tab-brief">
				<ul class="layui-tab-title">
					<li class="layui-this">Top10 最受欢迎店铺</li>
				</ul>
				<div class="layui-tab-content">
					<div class="layui-tab-item layui-show">
						<dl class="layuiadmin-card-status">
							<volist name="welcome_merchants" id="vo">
								<dd>
									<div class="layui-status-img layui-status-imgs"><a href="javascript:;" style="background-image: url('{$vo['image']}');background-position: center;background-size: cover;"></a></div>
									<div>
										<p>{$vo.id}-{$vo['name']}</p>
										<p>到店：{$vo['arrive_num']}次</p>
										<span>{$vo['vip_discount']}</span>
									</div>
								</dd>
							</volist>
						</dl>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="layui-col-sm4">
		<div class="layui-card">
			<div class="layui-tab layui-tab-brief">
				<ul class="layui-tab-title">
					<li class="layui-this">Top10 勤奋会员</li>
				</ul>
				<div class="layui-tab-content">
					<div class="layui-tab-item layui-show">
						<dl class="layuiadmin-card-status">
							<volist name="diligent_users" id="vo">
								<dd>
									<div class="layui-status-img layui-status-imgs"><a href="javascript:;" style="background-image: url('{$vo['headimgurl']}');background-position: center;background-size: cover;"></a></div>
									<div>
										<p>{$vo.id}-{$vo['nickname']}</p>
										<p>到店：{$vo['arrive_num']}次</p>
										<span>累计领取糖豆：{$vo['candy_num']}个</span>
									</div>
								</dd>
							</volist>
						</dl>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="layui-row layui-col-space15">
	<div class="layui-col-sm12">
		<div class="layui-card">
			<div class="layui-tab layui-tab-brief">
				<ul class="layui-tab-title">
					<li class="layui-this">送出娃娃分布图</li>
				</ul>
				<div class="layui-tab-content">
					<div class="layui-tab-item layui-show">
						<div id="container" class="layui-tab-item layui-show" style="height: 600px;margin-top:10px;"></div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
</div>
<script src="__PUBLIC__/resources/layui/layui.all.js"></script>
<script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.8&key=ce1d7952bfe7215b1cecb51b69ae04f2&plugin=AMap.PlaceSearch"></script>
<script type="text/javascript" src="https://cache.amap.com/lbs/static/PlaceSearchRender.js"></script>
<script type="text/javascript">
	var map,lat,lng,marker = null,positionPicker = null;
	var infoWindow;
	map = new AMap.Map('container', {
		resizeEnable: true,
		center: [108.886676, 34.215289],
		zoom: 12,
	});
	AMapUI.loadUI(['control/BasicControl'], function(BasicControl) {
		//缩放控件，显示Zoom值
		map.addControl(new BasicControl.Zoom({
			position: {
				top:'70px',
				right:'10px',
			},
			showZoomNum: true
		}));
	});
	map.clearMap();  // 清除地图覆盖物
	var placeSearch = new AMap.PlaceSearch();
	var placeSearchRender=new Lib.AMap.PlaceSearchRender();
	var markers = [];
    //关键字查询，您如果想修改结果展现效果，请参考页面：https://lbs.amap.com/fn/css-style/
    <?php foreach($list as $key=>$val){?>
    	placeSearch.search('<?php echo $val['address'];?>',function(status, result){
    		console.log(status,result,<?php echo $val['id'];?>);
    		if (status === 'complete' && result.info === 'OK') {
    			var temp = {
    				position: [result.poiList.pois[0].location.lng, result.poiList.pois[0].location.lat]
    			};
    			marker = new AMap.Marker({
    				map: map,
    				position: [temp.position[0], temp.position[1]],
    				offset: new AMap.Pixel(-12, -36),
    				extData:{
    					'id':<?php echo $val['id'];?>,
    					'user_id':'<?php echo $val['user_id'];?>',
    					'address':'<?php echo $val['address'];?>',
    					'phone':'<?php echo $val['tel'];?>',
    					'realname':'<?php echo $val['realname'];?>',
    					'position': [result.poiList.pois[0].location.lng, result.poiList.pois[0].location.lat]
    				}
    			});

    			markers.push(marker);
    			marker.on('click', function(e){
                //alert(1);
                openInfo(this.getExtData());
            });
    		}
    	});
    	<?php }?>
     //在指定位置打开信息窗体
     function openInfo(data) {
        //构建信息窗体中显示的内容
        var info = [];
        info.push("<div style=\"padding:0px 0px 0px 4px;\"><b>"+data['user_id']+'-'+data['realname']+"</b>");
        info.push("电话 : "+data['phone']);
        info.push("地址 :"+data['address']+"</div></div>");
        infoWindow = new AMap.InfoWindow({
            content: info.join("<br/>")  //使用默认信息窗体框样式，显示信息内容
        });
        infoWindow.open(map, data['position']);
    }

	/*
    // 添加一些分布不均的点到地图上,地图上添加三个点标记，作为参照
    markers.forEach(function(marker) {
        new AMap.Marker({
            map: map,
            position: [marker.position[0], marker.position[1]],
            offset: new AMap.Pixel(-12, -36)
        });
    });*/
    AMapUI.loadUI(['overlay/SimpleInfoWindow'], function(SimpleInfoWindow) {


    	var infoWindow = new SimpleInfoWindow({

    		infoTitle: '<strong>这里是标题</strong>',
    		infoBody: '<p class="my-desc"><strong>这里是内容。</strong> <br/> 高德地图 JavaScript API，是由 JavaScript 语言编写的应用程序接口，' +
    		'它能够帮助您在网站或移动端中构建功能丰富、交互性强的地图应用程序</p>',

            //基点指向marker的头部位置
            offset: new AMap.Pixel(0, -31)
        });


    });
    function openInfoWin() {
    	infoWindow.open(map, markers.getPosition());
    }


    function jumpToSelectedDays(days){
    	window.location.href = get_url(window.location.href,'days',days);
    }
</script>
